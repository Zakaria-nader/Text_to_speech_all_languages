const synth = window.speechSynthesis;
const languageSelect = document.getElementById('language');
const voiceSelect = document.getElementById('voiceSelect');
let voices = [];

function loadVoices() {
  voices = synth.getVoices();

  // خزن اللغات مع أسماء عربية وديناميكية
  const languagesMap = {};

  voices.forEach(v => {
    const langCode = v.lang;
    // ضع الاسم العربي المناسب لكل كود لغة، وإلا اترك الكود نفسه
    if (!languagesMap[langCode]) {
      languagesMap[langCode] = getLanguageName(langCode);
    }
  });

  // امسح القائمة واملأها
  languageSelect.innerHTML = '';
  Object.entries(languagesMap).forEach(([code, name]) => {
    const option = document.createElement('option');
    option.value = code;
    option.textContent = `${name} (${code})`;
    languageSelect.appendChild(option);
  });

  // اختر أول لغة تلقائياً واملأ أصواتها
  if(languageSelect.options.length > 0) {
    languageSelect.selectedIndex = 0;
    populateVoices(languageSelect.value);
  }
}

function getLanguageName(code) {
  // قم بتعريب أشهر اللغات فقط
  const map = {
    "ar-SA": "العربية (السعودية)",
    "ar-EG": "العربية (مصر)",
    "ar": "العربية",
    "en-US": "الإنجليزية (أمريكا)",
    "en-GB": "الإنجليزية (بريطانيا)",
    "fr-FR": "الفرنسية (فرنسا)",
    "es-ES": "الإسبانية (إسبانيا)",
    "de-DE": "الألمانية (ألمانيا)",
    "it-IT": "الإيطالية (إيطاليا)",
    "ja-JP": "اليابانية (اليابان)",
    "ko-KR": "الكورية (كوريا)",
    "zh-CN": "الصينية (الصين)"
  };
  return map[code] || code;
}

function populateVoices(lang) {
  voiceSelect.innerHTML = '';
  const filteredVoices = voices.filter(v => v.lang === lang);
  if(filteredVoices.length === 0) {
    voiceSelect.disabled = true;
    const option = document.createElement('option');
    option.textContent = "لا توجد أصوات متاحة";
    voiceSelect.appendChild(option);
    return;
  }
  voiceSelect.disabled = false;
  filteredVoices.forEach(v => {
    const option = document.createElement('option');
    option.value = v.name;
    option.textContent = v.name;
    voiceSelect.appendChild(option);
  });
  voiceSelect.selectedIndex = 0;
}

languageSelect.addEventListener('change', () => {
  populateVoices(languageSelect.value);
});

// عند تحميل الأصوات
if (speechSynthesis.onvoiceschanged !== undefined) {
  speechSynthesis.onvoiceschanged = loadVoices;
}

// استدعاء أولي لتحميل الأصوات
loadVoices();
